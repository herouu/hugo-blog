---
title: 网站从小到大架构演进
date: 2018-12-22 14:09:39
tags: ["架构"]

---

今天讲讲网站的演进过程

<!--more-->

#### V1 无名小生的诞生

&emsp;&emsp; linux+mysql+tomcat+java
&emsp;&emsp;应用程序、数据库、文件等所有资源都在一台服务器上。
![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/1.png)

#### v2 应用服务与数据服务分离

&emsp;&emsp;随着网站业务的发展，一台服务器逐渐不能满足需求：越来越多的用户访问导致性能越来越差，越来越多的数据导致存储空间不足。这时就需要将应用和数据分离。应用和数据分离后整个网站使用 3 台服务器：应用服务器、文件服务器和数据库服务器。这 3 台服务器对硬件资源的要求各不相同：
3 台服务器有不同的硬件要求
应用服务器：需要处理大量的业务逻辑，需要更快更强大的 cpu
数据库服务器： 需要快速硬盘检索和数据缓存，需要更快的硬盘和更大的内存
文件服务器：需要存储大量用户上传的文件，需要更大的硬盘
带来的好处： 不同的服务器承担不同的服务角色，得到很大的改善
![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/2.png)

#### V3 使用缓存改善性能

缓存分为

- 本地缓存
- 远程分布式缓存
  ![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/31.png)

#### V4 使用应用服务器集群-改善网站并发处理能力

&emsp;&emsp;引入负载均衡组件
&emsp;&emsp;负载均衡

- 软件 nginx
- 硬件 F5
- DNS 负载均衡
  ![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/4.png)

#### V5 数据库读写分离

&emsp;&emsp;网站在使用缓存后，使对大部分数据读操作访问都可以不通过数据库就能完成，但是仍有一部分读操作（缓存访问不命中、缓存过期）和全部的写操作都需要访问数据库，在网站的用户达到一定规模后，数据库因为负载压力过高而成为网站的瓶颈。 目前大部分的主流数据库都提供主从热备功能，通过配置两台数据库主从关系，可以将一台数据库服务器的数据更新同步到另一台服务器上。网站利用数据库的这一功能，实现数据库读写分离，从而改善数据库负载压力。如下图所示：
![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/5.png)

#### V6 使用反向代理和 CDN 加速

&emsp;&emsp;随着网站业务不断发展，用户规模越来越大，由于中国复杂的网络环境，不同地区的用户访问网站时，速度差别也极大。有研究表明，网站访问延迟和用户流失率正相关，网站访问越慢，用户越容易失去耐心而离开。为了提供更好的用户体验，留住用户，网站需要加速网站访问速度。主要手段有使用 CDN 和方向代理。如下图所示：
![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/6.png)
&emsp;&emsp;CDN 和反向代理的基本原理都是缓存。
&emsp;&emsp;CDN 部署在网络提供商的机房，使用户在请求网站服务时，可以从距离自己最近的网络提供商机房获取数据
&emsp;&emsp;反向代理则部署在网站的中心机房，当用户请求到达中心机房后，首先访问的服务器是反向代理服务器，如果反向代理服务器中缓存着用户请求的资源，就将其直接返回给用户
&emsp;&emsp;使用 CDN 和反向代理的目的都是尽早返回数据给用户，一方面加快用户访问速度，另一方面也减轻后端服务器的负载压力。

#### V7 使用分布式文件系统和分布式数据库系统(分库分表)

&emsp;&emsp;任何强大的单一服务器都满足不了大型网站持续增长的业务需求。数据库经过读写分离后，从一台服务器拆分成两台服务器，但是随着网站业务的发展依然不能满足需求，这时需要使用分布式数据库。文件系统也一样，需要使用分布式文件系统。如下图所示：

- 分布式文件系统
  - FastDFS
  - TFS
- 分布式数据库文件系统
  - MyCAT
  - sharding-JDBC
    ![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/7.png)

#### V8 使用 NoSQL、搜索引擎

&emsp;&emsp;随着网站业务越来越复杂，对数据存储和检索的需求也越来越复杂，网站需要采用一些非关系数据库技术如 NoSQL 和非数据库查询技术如搜索引擎

- 搜索引擎(复杂的文本检索) ElasticSearch Solr
- NoSql MongoDB HBase
  ![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/8.png)

#### V9 业务拆分

&emsp;&emsp;大型网站为了应对日益复杂的业务场景，通过使用分而治之的手段将整个网站业务分成不同的产品线。如大型购物交易网站都会将首页、商铺、订单、买家、卖家等拆分成不同的产品线，分归不同的业务团队负责。

&emsp;&emsp;具体到技术上，也会根据产品线划分，将一个网站拆分成许多不同的应用，每个应用独立部署。应用之间可以通过一个超链接建立关系（在首页上的导航链接每个都指向不同的应用地址），也可以通过消息队列进行数据分发，当然最多的还是通过访问同一个数据存储系统来构成一个关联的完整系统，如下图所示：
![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/9.png)

#### V10 分布式服务（微服务化）

- 微服务框架
  - Dubbo
  - Spring Cloud
- 配置中心
- Zookeeper
- SpringCloud Config
- disconf 百度
- config-tookit 当当
- diamond 阿里
  ![](https://bj.bcebos.com/v1/alertcode-blog/网站从小到大架构演进/10.png)

#### V11 使用大数据技术、监控、日志分析系统

&emsp;&emsp;数据挖掘、分析、推荐等业务需求，庞大系统的监控、问题分析等需求
